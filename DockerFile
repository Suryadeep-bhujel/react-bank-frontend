# ---------- dev (hot reload) ----------
FROM node:20-alpine AS dev
WORKDIR /app
# Copy only what's needed to install
COPY package*.json ./
COPY tsconfig*.json ./
COPY vite.config.* ./
RUN npm ci
# Copy source explicitly (avoid .dockerignore surprises)
COPY src ./src
COPY public ./public
COPY @bank-app-common ./@bank-app-common 
# COPY openapi-request ./openapi-request
# add any other needed folders here
CMD ["npm","run","dev","--","--host"]

# ---------- build (production build) ----------
FROM node:20-alpine AS build
WORKDIR /app
COPY package*.json ./
COPY tsconfig*.json ./
COPY vite.config.* ./
RUN npm ci
# Copy source explicitly
COPY src ./src
COPY public ./public
COPY @bank-app-common ./@bank-app-common
# COPY openapi-request ./openapi-request
# Optional: ensure TS has Node types at build time
ENV NODE_OPTIONS=--max-old-space-size=2048
RUN npm run build

# ---------- runtime (nginx) ----------
FROM nginx:alpine AS runtime
COPY --from=build /app/dist /usr/share/nginx/html
EXPOSE 80
CMD ["nginx","-g","daemon off;"]
